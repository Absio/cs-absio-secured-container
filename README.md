# Absio Secured Containers

Protect your application's sensitive data with Absio Secured Containers.

This module is currently in **Beta**.  Please [contact us](#obtaining-an-api-key) if you would like to join this **Beta** program.

## Index

* [Absio Technology](#absio-technology)
* [Getting Started](#getting-started)
* [Usage](#usage)
* [Examples](#examples)
* [API](#api)
* [Support and Bug Reporting](#support-and-bug-reporting)
* [License Agreement](#license-agreement)

## Absio Technology

Absio offers a set of tools that developers can use to protect application data throughout its lifecycle—from creation to deletion, everywhere it exists—without having to manage keys, add hardware, increase latency or rely on a third-party service for access to data. Absio’s cross-platform, Serverless Encryption technology automatically encrypts any type of data (bits, file or stream) generated or processed by an application prior to being stored or transmitted, each with its own unique key. Data content keys are uniquely encrypted for each user given access to the data, allowing user-specific access and permissions to be added or revoked at any time without needing to re-encrypt the data object. All key generation and management is performed automatically on the device running the application and not by a central key server. Encrypted data objects and content keys can be stored locally in an obfuscating file system to reduce network latency impacts and enable local content to be decrypted and encrypted while offline. Absio technology automatically obfuscates file names and types and randomizes the folder structure, enabling keys and content to be stored locally without putting data at risk.

In addition, developers can use Absio tools to associate classification, audit history, policy and other metadata from any source, enabling software applications to consume this information and 1) process and update metadata without providing access to, or decrypting content, and/or 2) restrict who, how, where, and for how long decrypted content can be used. For data sharing, Absio technology provides an automated public key infrastructure, and a portable (installable anywhere), zero-knowledge server application for authentication, content/key exchange, sync, and backup.

### Components

The Absio developer toolset consists of cross platform-capable software development kits (SDKs), each with a simple application programming interface ([API](#api)), and a portable server application ([Absio API Server Application](#absio-api-server-application)). The Absio SDK is currently available in JavaScript (Browser and Node.js) and C#. SDKs for Swift, Java and Python will be available late summer 2017. The Absio Server Application is written in Python and can be deployed by the organization via a Python package, RPM, VM or Docker container. All communication with the Absio Server Application is handled by the SDK methods, so no separate API calls are required. 

### Goals

Several goals were identified and met in the creation of Absio's developer toolset: 
* Simple [API](#api)
* Flexible architecture
* Serverless Encryption - key generation and encryption at the application
* Automatic key generation and management
* Bound metadata - encrypted with content (See the header portion of an [Absio Secured Container](#absio-secured-containers) for more details)
* Associated metadata - stored in database and related to content (See the type field under the [Containers](#container-object) section for more details)
* Offline access (See [Obfuscating File System](#obfuscating-file-system))
* Strong, safe and verifiable [encryption](#encryption)

### Absio API Server Application

The Absio API Server Application is used for identity management in the Absio ecosystem through usage and distribution of public keys. [Users](#users) are registered through the SDK and their public keys are stored on the Absio API Server Application, accessible to all other registered Users. Container access is stored on the Absio API Server Application.<p>

The Absio API Server Application tracks and distributes container-related events when [Absio Secured Containers](#absio-secured-containers) are:
  * Accessed
  * Created
  * Deleted (access or content removed)
  * Updated

### Users

A User is an entity with a set of private keys and an identifier. There are two main key types: those used for signature verification, and those used for derivation. The user’s public keys are registered with the [Absio API Server Application](#absio-api-server-application) and are made available to other Absio users. These public keys allow for granting [access](#container-object) to [Absio Secured Containers](#absio-secure-containers) and validating user actions. The identifier (User ID) is a GUID generated by the SDK.<p>

Users are able to create [Absio Secured Containers](#absio-secure-containers) that are each uniquely encrypted. Optionally, a User can grant other Users [access](#container-object) to an [Absio Secured Container](#absio-secure-containers) and add unique permissions or lifespan controls.

### Absio Secured Containers

An Absio Secured Container (ASC) is the fundamental encrypted data structure in the Absio ecosystem. A [Container's](#container-object) header and content are part of the encrypted data.<p>

#### Header

The header is any information about the content that is private or sensitive (should be encrypted), or that needs to remain with the data wherever it goes. The header must be JSON serializable. The header can be independently decrypted without downloading and/or decrypting the content.

#### Content

The content is the data payload of the container. While there are no limitations on maximum size of a container, your performance and experience may vary depending on platform limitations.

#### Granting Access

Access to [Absio Secured Containers](#absio-secure-containers) can be shared with other [Users](#users) registered with the [Absio API Server Application](#absio-api-server-application). Granting access allows a user to define explicit [Permissions](#permissions) for each user to view and modify aspects of the container, as well as define when access to the container will expire.

Unless [Permissions](#permissions) are explicitly defined, the [User](#users) creating or updating the [Container](#container-object) will be given full permissions to the container without an expiration.

##### Permissions

The permissions define how the [Absio API Server Application](#absio-api-server-application) will respond to create, read, update and delete operations for a given [Container](#container-object).  Therefore, the Absio SDK and [API Server Application](#absio-api-server-application) will be enabled or disabled from performing certain operations based on these permissions as well.  For instance, if the [Permission.DownloadContainer](docs/Absio.Sdk.Container.md#-permission-) property is `false` for a [User](#users), and they request the [Container](#container-object) with the [Get](#get)  method, the container returned to the user will not have the decrypted content or header since the Absio API Server Application will not return the content URL to the SDK.

### Key File

An AES256 encrypted key file is created for each [User](#users), which contains the user's private keys (both signing and derivation) and password reset information. The user's password is used to encrypt the private keys.<p>

A passphrase may also be provided allowing a key file to be synchronized between devices, as well as enabling secure password reset. By default, the user's key file is backed up on the Absio API Server Application, but may optionally be stored locally in the [Obfuscating File System](#obfuscating-file-system).

### Obfuscating File System

If the application using the SDK supports file storage, then the SDK can be used for secure local storage.  The local storage acts as a cache allowing for offline access of data, as well improved performance (no need to request the keys and content from the [Absio API Server Application](#absio-api-server-application)).<p>

Local storage is performed in the Obfuscating File System (OFS).  The OFS creates random, nonsensical paths within the root directory for all files.  This serves to remove any identifiable attributes (file name and associated content), ruining the economics of an attempt to target specific files for brute-force decryption.  Optionally, the content within the OFS can be segregated by User ID. 

### Encryption

A [User's](#users) private keys are stored in an encrypted [Key File](#key-file). The key file is encrypted with AES256 using a key derived from the user's password.<p>

Each [Absio Secured Container](#absio-secure-containers) has a unique set of secret keys.

* HMAC-SHA256 digests are used for content validation to mitigate content tampering.
* AES256 keys are used to individually encrypt the header and content.

These secret keys are uniquely encrypted for each user that can access the container. This encryption process uses Static-Ephemeral Diffie-Hellman Key Exchange (DHKE) based upon a user's public derivation key. This process ensures that the decryption of the container's secret keys can only be accomplished using the user's corresponding private key. Furthermore the container keys are signed with the creator’s private signing keys to help mitigate Main-in-the-Middle attacks.

## Getting Started

After [Obtaining an API Key](#obtaining-an-api-key), reference the [Quick Start](#quick-start) section to begin adding [Absio Secured Containers](#absio-secure-containers) to your application.

### Obtaining an API Key

The Absio SDK requires a valid API Key that must be passed into the [SessionAttributes constructor](docs/Absio.Sdk.Session.md#-sessionattributes-). Obtain an API Key by [contacting us here](https://www.absio.com/contact) or sending an email to [sales@absio.com](mailto:sales@absio.com). An API key should be considered private and protected as such.

### Quick Start

The `userId`, `password`, and `passphrase` used below are the credentials for two existing users.  To simplify the example, the [Users](#users) are called Alice and Bob. [Users](#users) can be created with the [SecureContainerSession.RegisterAsync](docs/Absio.Sdk.Session.md#-securedcontainersession-) method. For more details, see the [Users](#users) section above.

1. Libraries and Dependencies
    * AbsioSdk
    * AbsioCrypto
    * AbsioESqlite
    * Newtonsoft Json.NET

2. Initialize the session attributes:

   ``` c#
   SessionAttributes sessionAttributes = new SessionAttributes
   {
        ApiKey = "<your API key>",
        ApplicationName = "<your application name>",
        ApplicationOfsSeed = "<your application OFS seed>",
        ServerUrl = "https://your.AbsioApiServerURL.com",
        OfsRootDirectory = "C:\ProgramData\Absio\"
    };
   ```

3. Initialize the module and log in with an account:  

   ``` c#
    SecuredContainerSession aliceSession = new SecuredContainerSession(sessionAttributes);
    await aliceSession.LogInAsync(AliceUserId, AlicePassword, AliceBackupPassphrase);
   ```

4. Start creating [Absio Secured Containers](#absio-secure-containers):

   ``` c#
    byte[] content = <your data to protect>;
    object jsonHeader = <your data descriptor>;
    List<ContainerAccessLevel> containerAccessList = new List<ContainerAccessLevel>
    {
        new ContainerAccessLevel()
        {
            UserId = BobsUserId,
            Permissions = Permission.Write,
            ExpireTime = DateTime.Now.AddMonths(1)
        }
    };
    Guid containerId = await aliceSession.CreateAsync(content, header: jsonHeader, accessLevels: containerAccessList, type: "unstructured-data");
   ```

5. Securely access these [Absio Secured Containers](#absio-secure-containers) from another system:

   ``` c#
    SecuredContainerSession bobSession = new SecuredContainerSession(sessionAttributes);
    await bobSession.LogInAsync(BobUserId, BobPassword, BobBackupPassphrase);
 
    List<ContainerEvent> containerEvents = await bobSession.GetLatestEventsAsync();
 
    Guid knownContainerId = <ID of an accessible container>;
    Container knownContainer = await bobSession.GetAsync(knownContainerId);
   ```

## Usage
The following usage examples require that the general setup in [Getting Started](#getting-started) has been completed.

### Container Providers

By default, [Absio Secured Containers](#absio-secure-containers) can come from one of two locations.  The [Obfuscating File System](#obfuscating-file-system) (if local storage is used) or the [Absio API Server Application](#absio-api-server-application) (if a connection exists and server storage is used).  To help accommodate the different requirements that customers will have, three different Absio Secured Container providers were created to help manage user intent on [Container](#container-object) source and destination location.  Each of the providers are described below.

#### OFS Container Provider

Use this provider to create, read, update and delete Absio Secured Containers from local storage (Obfuscating File System).  Using this provider, you cannot grant/modify access to other users in the system.  All create, update and delete operations only affect the local storage for the authenticated user.  There is no event system for local storage.  

#### Server Container Provider

Use this provider to create, read, update and delete Absio Secured Containers from the Absio API Server Application.  Using this provider, you can grant/modify access to other users in the system.  All create, read, update and delete operations will be tracked by the Absio API Server Application for the relevant user.  Use the event system on the Absio API Server Application to retrieve the events.  See [SecureContainerSession.GetLatestEventsAsync](docs/Absio.Sdk.Session.md#-securedcontainersession-) for more detail on events.  This is the default provider when you do not have local storage (browser).

<b>NOTE:</b> If the system running the SDK has local storage (not a browser), the SDK will still cache all public signing and derivation keys in the Obfuscating File System.

#### Server Cache OFS Container Provider

Use this provider for the best user experience. This provider acts similar to the [Server Container Provider](#server-container-provider), but also uses the local storage (Obfuscating File System) as an Absio Secured Container cache to facilitate faster read times and allow for offline access.  This is the default provider when you have local storage (not in a browser).

##### Container Create

All created [Containers](#container-object) and associated keys are stored on the Absio API Server Application and cached locally (Obfuscating File System).  If the Absio API Server Application cannot be reached, the whole transaction will be aborted.

##### Container Read

If available, containers will be pulled from the cache (local storage - Obfuscating File System).  If not available, containers will be pulled from the Absio API Server Application.  When a container is pulled from the Absio API Server Application, the container and associated keys will be stored in the Obfuscating File System.

##### Container Update

All updated containers and associated keys are stored on the Absio API Server Application and cached locally (Obfuscating File System).  If the Absio API Server Application cannot be reached, the whole transaction will be aborted.

##### Container Delete

All deleted containers and associated keys are removed locally (Obfuscating File System) and on the Absio API Server Application.  If the Absio API Server Application cannot be reached, the whole transaction will be aborted.

#### Changing Container Providers

By default, if you have access to local storage (not running in a browser), the [Server Cache OFS Container Provider](#server-cache-ofs-container-provider) is used.  Otherwise, the [OFS Container Provider](#ofs-container-provider) is used.  Below is an example on how to change to the [Server Container Provider](#server-container-provider).

``` c#
_secureContainerSession.SetOfsContainerProvider();
_secureContainerSession.SetServerContainerProvider();
_secureContainerSession.SetServerCacheOfsContainerProvider();
```

### Create
This is an example of creating an Absio Secured Container that contains sensitive data.

``` c#
byte[] sensitiveData = new byte[]('Sensitive Data...000-00-0000...');

// Optional: Define a custom header that is bound to the content with encryption.

// Optional: Grant access to the Container with permissions and/or expiration.
DateTime expiration = DateTime.Today.AddDays(1);
Permission permissions = Permission.DecryptContainer | Permission.DownloadContainer | Permission.ViewAccess;
var accessList = new List<ContainerAccessLevel>()
    {
        new ContainerAccessLevel(userId, expiration, permissions)
    };

// Create the container
var containerId = await _secureContainerSession.CreateAsync(sensitiveData, customHeaderObject, accessList, type);
```

### Get

This demonstrates the ways to get containers.

``` c#
// Get the Container with a known ID
IContainer container = await _securedContainerSession.GetAsync(knownContainerId);

// The Absio API Server Application creates an event for when a Container is new, updated, deleted, or first accessed.
List<ContainerEvent> latestEvents = await _securedContainerSession.getLatestEventsAsync();

// Events contain the corresponding Container ID for getting the related Container.
int eventContainerId = latestEvents[0].ContainerId;
IContainer containerFromEvent = await _securedContainerSession.GetAsync(eventContainerId);

// Optionally can be filtered to return only the latest events of a given Container type and/or event action.
List<ContainerEvent> latestUpdatedOfType = await _securedContainerSession.getLatestEventsAsync(containerType: type);
```


### Update

This example shows how to update portions of a Container, including the header, content, and type.  Only the fields specified will be updated.  To clear a value, this must be explicitly set.

``` c#
// Get the Container securely.
IContainer container = await _securedContainerSession.GetAsync(knownContainerId);

byte[] newContent = new byte[] {0, 1, 2, 3};
object header = <new custom header object>;
string type = "newType";
            
var accessList = new List<ContainerAccessLevel>();
accessList.Add(new ContainerAccessLevel(sessionOwner.GetUserId(), ContainerAccessLevel.DefaultOwnerPermissions));
accessList.Add(new ContainerAccessLevel(sessionReceiver.GetUserId()));

await _securedContainerSession.UpdateAsync(cId, content, header, accessList, type);
```

This shows redefining only the type of an Absio Secured Container with known ID.  The type is the only field of the Absio Secured Container that will be changed in this update call.

``` c#
await _securedContainerSession.UpdateAsync(knownContainerId, type: "redefinedContainerType");
```

### Delete

Permanently remove access to an Absio Secured Container for the authenticated user.<br><br>
<b>NOTE:</b> This does not delete the content for all users with access.  See the [SecureContainerSession.DeleteAsync](docs/Absio.Sdk.Session.md#securedcontainersession) method for more details.

``` c#
await _securedContainerSession.DeleteAsync(knownContainerId);
```

## Examples

Visit our [Examples](examples/README.md) page on GitHub..

## API

Information about the available functions of the Absio SDK (such as data requirements, error codes, etc) can be found on our Github [documentation](docs/README.md).

### Permissions

| Permission  | Creator's Default | Other User's Default | Description |
|:------------|:----------------|:---------------------|:-----------
|`View Access` | `true` | `true` | Permission to view the full access list containing all other [User's](#users) IDs, expiration dates, and permissions.  Set to `false` to prevent a [User](#users) from seeing other [Users'](#users) access information for the [Container](#container-object).
|`Modify Access` | `true` | `false` | Permission to add, remove, or update all [Users'](#users) access to a [Container](#container-object).  Set to `true` to allow a [User](#users) to modify access to the [Container](#container-object).  <br><br><b>NOTE:</b> you should also set `View Access` to `true` if this is `true`.  Otherwise, the [User](#users) can modify the access list, but not include others who have access.
|`Decrypt Container` | `true` | `true` | Permission to access the key blob required for this [User](#users) to decrypt the [Container](#container-object).  Set to `false` to prevent a [User](#users) from being able to decrypt the [Container's](#container-object) content and header.
|`Download Container` | `true` | `true` | Permission to allow a [User](#users) to download the encrypted [Container's](#container-object) data.  Set to `false` to prevent a [User](#users) from accessing the encrypted [Container](#container-object) data.
|`View Container Type` | `true` | `false` | Permission to view the [Container's](#container-object) `type` field.  Set to `true` to allow a [User](#users) to see the [Container's](#container-object) `type` field.
|`Modify Container Type` | `true` | `false` | Permission to modify the [Container's](#container-object) `type` field.  Set to `true` to allow a [User](#users) to make changes to a [Container's](#container-object) `type` field (in events and [Container](#container-object) requests).
|`Upload Container` | `true` | `false` | Permission to upload changes to the [Container's](#container-object) content and header.  Set to `true` to allow a [User](#users) to upload changes to the content and header of a [Container](#container-object).  <br><br><b>NOTE:</b> If setting `Upload Container` to true, `View Access` and `Modify Access` should also be set to `true`. Otherwise this combination of permissions will be rejected by the SDK and server. 

##### Known Permission Error Cases

Below are some permissions states that may have adverse effects. 
* `View Access` is `false` and `Modify Access` is `true`.  The [User](#users) can update the access list, but will not know the other [Users](#users) with current access.  Thus, the update could potentially remove all access from the current access list (aside from the User performing the operation).
* `View Access` is `false` and `Upload Container` is `true` and `Modify Access` is `true`.  The [User](#users) can update the access list and content, but will not know the other [Users](#users) with current access.  Thus, the update could potentially remove all access from the current access list (aside from the User performing the operation).
* `View Access` is `true` and `Upload Container` is `true` and `Modify Access` is `false`.  This operation will be rejected by the [Absio API Server Application](#absio-api-server-application).  Since uploading content requires re-keying the data, all access must be updated (each User with access will get a new `keyBlob`).  Since they cannot `modify` access, it will be rejected.
* `Upload Container` is `false`.  Calls to [Update](#update) will be rejected by the [Absio API Server Application](#absio-api-server-application). 
* `Upload Container` is `true` and `Modify Container Type` is `false`.  Calls to [Update](#update) that include the `type` will be rejected by the Absio API Server Application.
* `Download Container` is `false` or `Decrypt Container` is `false`. If the data is not cached locally in the [OFS](#obfuscating-file-system), calls to [Get](#get) will return a [Container](#container-object) with `content` and `header` null.

## Support and Bug Reporting

Please [contact us](https://github.com/Absio/cs-absio-secured-container/issues) if you experience any issues using this module.  Use the project's [Github issue tracker](https://github.com/Absio/cs-absio-secured-container/issues) to report all issues.

## License Agreement

See the LICENSE file of the module.